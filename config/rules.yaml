###############################################
# Reglas del bot (configuraci√≥n funcional)    #
# - TODAS las opciones funcionales van aqu√≠.  #
# - Secretos y tokens van en .env             #
# - Puedes crear overrides por chat/canal     #
###############################################

default:
  # Encendido general del bot por canal/grupo
  enabled: true                  # Si es false, el bot ignora mensajes en este chat/canal

  # Metadatos y textos base del bot
  bot_name: "AtencionClienteBot" # Nombre del bot (s√≥lo informativo/logs)
  locale: "es"                   # Idioma principal
  greetings_enabled: true        # (obsoleto, usar greeting_enabled)
  greeting_enabled: true         # Si es true, el bot muestra el saludo antes del men√∫
  # Mostrar saludo y men√∫ autom√°ticamente en el primer mensaje si parece un saludo corto (e.g., "hola", "buenas").
  # Si el primer mensaje del usuario parece una intenci√≥n (varias palabras), el bot prioriza la intenci√≥n.
  greeting_force_on_first_message: true
  # Mostrar un prompt en el saludo para ofrecer el men√∫ solo si se solicita (cuando los men√∫s est√©n habilitados)
  greeting_menu_prompt_enabled: true
  greeting_menu_prompt_text: "Cu√©ntame, ¬øen qu√© te puedo ayudar hoy?üòé 

  
   Si quieres, tambi√©n puedo mandarte el men√∫ con todas las opciones disponibles."
  # Segundos de retraso entre el saludo y el mensaje de prompt (float o int)
  greeting_menu_prompt_delay: 2
  greeting_ttl_days: 7          # Repetir saludo autom√°ticamente despu√©s de N d√≠as (0 = nunca repetir)
  greeting_text: |               # Puedes personalizar este saludo. Si greeting_enabled es false, no se muestra.
    ¬°Hola Bienvenid@ a Urban elegance ! Soy tu asistente virtual.
  fallback_text: "No entend√≠ tu mensaje. dime si quieres ver las opciones del men√∫." # Respuesta por defecto si no se reconoce la entrada

  # =============================
  # Memoria conversacional (historial y temas)
  # =============================
  memory:
    enabled: true               # Registrar historial y temas abiertos
    history_max: 100            # M√°ximo de mensajes por usuario/chat en memoria
    # NUEVO: Duraci√≥n flexible para ofrecer retomar conversaci√≥n.
    # Usa 'resume_after' con unidades (recomendado): "30m", "2h", "1d".
    # Retrocompatibilidad: si 'resume_after_minutes' est√° presente, tiene prioridad.
    resume_after: "60m"         # Tiempo de inactividad para ofrecer retomar (m/h/d)
    resume_after_minutes: 60    # (Legacy) Ofrecer retomar si vuelve despu√©s de X minutos
    topic_ttl_days: 14          # Tiempo de vida de un tema abierto (d√≠as)
    offer_resume_message: "Veo que ten√≠as pendiente: {topic}. ¬øQuieres continuar?"
    history_command_enabled: true
    history_privacy_mask_emails: true

    # =============================
    # Inactividad (recordatorio y cierre autom√°tico)
    # =============================
    inactivity:
      enabled: true
      # Enviar un recordatorio si el usuario no responde tras este tiempo.
      # Formatos soportados: "30m" (minutos), "2h" (horas), "1d" (d√≠as), "1h 30m".
      reminder_after: "3m"
      reminder_message: "¬øSigues ah√≠? Si necesitas ayuda, puedes contarme m√°s o escribe 'menu' para ver opciones."
      # Cerrar el chat si no hay respuesta tras este tiempo.
      close_after: "5m"
      close_message: "He cerrado el chat por inactividad. Si necesitas algo m√°s, escribe de nuevo para empezar un nuevo tema."
      # Enviar el recordatorio solo una vez por inactividad
      send_reminder_once: true
      # Estados del bot que se consideran 'esperando respuesta del usuario'
      monitor_states: ["ticket:ask_detail"]


  # Encendido/apagado de funcionalidades principales (features)
  # Puedes desactivar FAQ, tickets, escalaci√≥n, etc. por canal o global
  features:
    connectors:
      telegram_enabled: true     # Conector Telegram activo (requiere TELEGRAM_TOKEN en .env)
      webchat_enabled: true      # Conector Webchat activo
      whatsapp_enabled: true     # Conector WhatsApp activo (requiere tokens .env)
    faq:
      enabled: true              # Respuestas autom√°ticas de FAQ
      not_found_message: "No encontr√© esa pregunta en el FAQ. ¬øQuieres crear un ticket?"
      # Umbral de similitud para considerar que un mensaje es una pregunta del FAQ.
      # Valor entre 0.0 y 1.0 (mayor = m√°s estricto). Ejemplo: 0.75
      match_threshold: 0.75
    tickets:
      enabled: true              # Gesti√≥n de tickets
      category_options: ["general", "facturacion", "tecnico"]
      default_priority: "normal"
    escalation:
      enabled: true              # Escalamiento a agente humano
      request_contact_fields: ["nombre", "correo"]

  # =============================
  # Cat√°logo configurable
  # Puedes poner el link de tu cat√°logo aqu√≠ y cambiar el texto que ver√° el usuario.
  catalog:
    enabled: true
    link: "https://drive.google.com/drive/folders/1AJG-4rTitxN8usuNeYy2gO9RZgSQ8VD1"
    # Mensaje final mostrado al usuario (editable desde aqu√≠). Mantener el link s√≥lo en este bloque.
    message: "Puedes ver nuestro cat√°logo completo aqu√≠: https://drive.google.com/drive/folders/1AJG-4rTitxN8usuNeYy2gO9RZgSQ8VD1"

  # Redes sociales y contactos (configurable por el usuario)
  socials:
    instagram: "https://www.instagram.com/urban.elegance2.0?igsh=dXc0Z2Z1bmNpM2xo"


  # =============================
  # Sin√≥nimos (atajos globales)
  # =============================
  # Palabras/atajos que el bot reconoce en cualquier estado para ciertos flujos.
  # Se usan como apoyo a NLU e interpretaci√≥n r√°pida fuera de men√∫s.
  synonyms:
    menu: ["menu", "men√∫", "/start", "inicio", "empezar", "hola", "buenas"]
    # Frases de aceptaci√≥n para que el usuario pida el men√∫ tras el saludo
    menu_accept: ["si", "s√≠", "menu", "men√∫", "ver menu", "ver men√∫", "opciones", "ver opciones", "dame el men√∫", "dame el menu", "quiero el menu"]
    faq: ["faq", "preguntas", "ayuda", "info", "informacion", "informaci√≥n"]
    ticket: ["ticket", "soporte", "reclamo", "incidencia", "abrir ticket", "crear ticket", "abrirr tiket", "tickets"]
    agent: ["agente", "humano", "asesor", "representante", "hablar con agente", "soporte humano", "quiero humano"]


  # =============================
  # Men√∫s din√°micos configurables
  # =============================
  # Si 'menus.items' est√° definido, el bot usar√° esta estructura en lugar del men√∫ cl√°sico.
  # Puedes definir cualquier cantidad de men√∫s y submen√∫s, con las opciones y acciones que desees.
  # Cada opci√≥n puede tener triggers (palabras o n√∫meros que la activan), acci√≥n y destino.
  # Para ocultar un men√∫ o una opci√≥n, usa 'enabled: false'.
  # Ejemplo: para ocultar el submen√∫ ventas_menu, pon 'enabled: false' en ese bloque.
  menus:
    enabled: true
    root: main
    items:
      main:
        text: |
          ¬øC√≥mo podemos ayudarte hoy?

          1Ô∏è‚É£ Informaci√≥n de productos y precios
          2Ô∏è‚É£ Soporte t√©cnico y reclamos
          3Ô∏è‚É£ Estado de mi pedido o ticket
          4Ô∏è‚É£ Hablar con un asesor humano
          5Ô∏è‚É£ Cat√°logo y productos
          9Ô∏è‚É£ Ver m√°s opciones
        options:
          - triggers: ["1", "productos", "precios", "cat√°logo", "faq"]
            action: goto
            target: faq_menu
            enabled: true
          - triggers: ["2", "soporte", "reclamo", "ticket", "problema", "crear ticket"]
            action: ticket_ask_detail
            enabled: true
          - triggers: ["3", "estado", "pedido", "consultar ticket", "ver ticket"]
            action: consultar_ticket
            enabled: true
          - triggers: ["4", "asesor", "humano", "agente", "hablar con agente"]
            action: escalation
            enabled: true
          - triggers: ["9", "m√°s", "opciones", "menu"]
            action: goto
            target: extra_menu
            enabled: true
          - triggers: ["5", "catalogo", "cat√°logo", "productos"]
            action: reply
            # Respuesta amable y profesional para el cat√°logo. Edita `default.catalog.link` si quieres cambiar la URL.
            reply_text: "¬°Genial! {catalog.message}\n\nSi quieres, puedo enviarte novedades o promociones cuando salgan. ¬øTe interesa recibir alertas?"
            enabled: true
      faq_menu:
        text: |
          Preg√∫ntame sobre cualquier tema: precios, productos, cat√°logo, env√≠os, pagos, devoluciones...
          Escribe 9 o 'men√∫' para volver al men√∫ principal.
        options:
          - triggers: ["9", "menu", "volver", "back"]
            action: back
      extra_menu:
        text: |
          Otras opciones:
          1Ô∏è‚É£ Informaci√≥n de la empresa
          2Ô∏è‚É£ Formas de pago y env√≠os
          9Ô∏è‚É£ Volver al men√∫ principal
        options:
          - triggers: ["1", "empresa", "qui√©nes son"]
            action: goto
            target: faq_menu
            enabled: true
          - triggers: ["2", "pago", "env√≠os", "formas de pago"]
            action: goto
            target: faq_menu
            enabled: true
          - triggers: ["9", "volver", "menu"]
            action: back

  # =============================
  # NLU simple configurable (intents y saludos)
  # =============================
  # Define saludos y patrones de intenci√≥n para orientar al usuario sin tocar c√≥digo.
  nlu:
    greetings:
      enabled: true
      triggers: ["/start", "hola", "buenas", "hello", "hi", "hey", "menu"]
    threshold: 0.78
    low_confidence_message: "Para ayudarte mejor puedo: mostrar el men√∫, crear un ticket o derivarte a un agente. ¬øQu√© prefieres?"
    provider: ml
    ml:
      retrain_on_start: false        # true para reentrenar en cada arranque (dev)
      model_path: data/models/nlu_nb.pkl
      char_ngrams: [3, 5]
      word_ngrams: [1, 2]
      alpha: 1.0
    intents:
      - name: ver_menu
        patterns: ["ver menu", "ver men√∫", "menu", "opciones", "inicio", "empezar"]
        action: goto
        target: main
      - name: ver_historial
        patterns: ["historial", "/historial", "ver historial", "mis mensajes"]
        action: reply
        reply_text: "Mostrando tu historial reciente‚Ä¶"
      - name: continuar
        patterns: ["continuar", "/continuar", "seguir", "retomar"]
        action: reply
        reply_text: "Retomando donde lo dejamos‚Ä¶"
      - name: abrir_ticket
        patterns: ["abrir ticket", "crear ticket", "tengo un problema", "reclamo", "soporte", "abrirr tiket", "tickets", "necesito soporte"]
        action: ticket_ask_detail
      - name: hablar_agente
        patterns: ["hablar con agente", "asesor", "humano", "agente", "soporte humano", "quiero humano", "quiero hablar con humano"]
        action: escalation
      - name: faq
        patterns: ["faq", "preguntas", "precios", "planes", "informaci√≥n", "informacion"]
        action: goto
        target: faq_menu
      - name: ver_catalogo
        patterns: ["catalogo", "cat√°logo", "ver cat√°logo", "ver el cat√°logo", "quiero ver el cat√°logo", "productos", "ver productos", "me gustar√≠a ver el cat√°logo", "me gustaria ver el catalogo"]
        action: reply
        # Respuesta m√°s formal y profesional. Usa {catalog.link} o {catalog.message} seg√∫n prefieras.
        reply_text: "Perfecto. Puede ver nuestro cat√°logo completo aqu√≠: {catalog.link}\n\n¬øDesea que le env√≠e novedades o promociones cuando haya lanzamientos?"
      - name: novedades
        patterns: ["novedades", "lanzamientos", "nueva colecci√≥n", "novedad"]
        action: reply
        reply_text: "Cada semana publicamos novedades. Puedes ver las √∫ltimas aqu√≠: https://tusitio.com/novedades. ¬øDeseas que te avise cuando lancemos algo nuevo?"
      - name: consultar_ticket
        patterns: ["ver ticket", "consultar ticket", "estado ticket", "/ticket"]
        action: reply
        reply_text: "Para consultar un ticket escribe: /ticket <id>. Por ejemplo: /ticket 123"
      - name: despedida
        patterns: ["gracias", "muchas gracias", "listo", "hasta luego", "adios", "adi√≥s"]
        action: reply
        reply_text: "¬°Con gusto! Si necesitas algo m√°s, estoy aqu√≠ para ayudarte."
      - name: satisfaccion
        patterns: ["que bien", "est√° bien", "est√° bien", "ok", "perfecto", "me gusta", "excelente", "super", "ch√©vere", "listo", "muy bien", "genial", "buen√≠simo", "aprobado", "funciona", "me encanta"]
        action: reply
        # Respuestas en tono formal (usted) para mayor profesionalidad
        responses:
          - "Me alegra que le haya resultado √∫til. Si necesita algo m√°s, con gusto le atiendo."
          - "Perfecto. Recuerde que puede consultar el men√∫ o solicitar novedades cuando lo desee."
          - "Excelente. Si tiene otra consulta, por favor ind√≠quemela y con gusto la atender√©."
          - "Me alegra saberlo. ¬øDesea que le env√≠e el cat√°logo o informaci√≥n sobre promociones?"
          - "Gracias por su comentario. Estoy a su disposici√≥n para cualquier otra gesti√≥n."
  # =============================
  # Base de conocimiento (FAQ)
  # =============================
  # Aqu√≠ defines las preguntas y respuestas que el bot usar√° en el submen√∫ FAQ.
  # Puedes agregar tantas como quieras. El bot busca coincidencias por palabra clave.
  faq:
  - q: "¬øQu√© puedes hacer?"
    keywords: ["qu√© puedes hacer", "qu√© haces", "qu√© opciones hay", "c√≥mo me puedes ayudar", "ayuda", "servicios", "funcionalidades", "qu√© ofrece el bot"]
    a: "{auto}"
  - q: "horario"
    keywords: ["horario", "a qu√© hora abren", "a qu√© hora cierran", "hasta qu√© hora", "qu√© d√≠as est√°n abiertos", "horas de atenci√≥n", "horarios"]
    a: "Nuestro horario es de lunes a s√°bado, de 10:00 a.m. a 8:00 p.m. üïó. Los domingos cerramos para recargar estilo üòé."
  - q: "ubicaci√≥n"
    keywords: ["ubicaci√≥n", "d√≥nde est√°n", "d√≥nde queda", "c√≥mo los encuentro", "direcci√≥n", "localizaci√≥n", "tienda f√≠sica", "d√≥nde se encuentran"]
    a: |-
      Somos una tienda virtual. No contamos con atenci√≥n presencial, todas las compras y consultas se gestionan a trav√©s de nuestra tienda online.

      Puede ver nuestro cat√°logo si lo pides aqu√≠ o contactarnos por nuestra tienda virtual: {socials.instagram}

      Si necesitas conocer opciones de env√≠o a su ciudad, ind√≠quenos su ubicaci√≥n y con gusto le informamos las alternativas y tiempos de entrega.
  - q: "precios"
    keywords: ["precios", "cu√°nto cuesta", "cu√°nto valen", "tarifas", "valor", "costos", "cu√°nto cobran", "cu√°l es el precio"]
    a: "Tenemos prendas desde $35 mil. Los precios dependen del modelo y colecci√≥n üëï. ¬øQuieres que te env√≠e el cat√°logo completo?"
  - q: "cat√°logo"
    keywords: ["cat√°logo", "productos", "colecci√≥n", "ver cat√°logo", "ver productos", "mostrar cat√°logo", "mostrar productos"]
    a: "Puedes ver nuestro cat√°logo m√°s reciente aqu√≠ üëâ {catalog.link}. ¬°Todo con flow urbano garantizado!"
  - q: "env√≠os"
    keywords: ["env√≠os", "envio", "entregas", "a d√≥nde env√≠an", "env√≠an a mi ciudad", "despachos", "c√≥mo env√≠an", "formas de env√≠o"]
    a: "Hacemos env√≠os a todo el pa√≠s üá®üá¥ (o donde apliques). Los pedidos se despachan en 24 a 48 horas."
  - q: "formas de pago"
    keywords: ["formas de pago", "c√≥mo pago", "m√©todos de pago", "puedo pagar con tarjeta", "aceptan nequi", "aceptan daviplata", "transferencia", "cu√°les son los m√©todos de pago"]
    a: "Aceptamos pagos por Nequi, Daviplata, transferencia bancaria y tarjeta üí≥. ¬°T√∫ eliges!"
  - q: "devoluciones"
    keywords: ["devoluciones", "cambios", "puedo cambiar", "c√≥mo hago un cambio", "reembolsos", "puedo devolver", "devolver producto"]
    a: "Aceptamos cambios dentro de los primeros 5 d√≠as h√°biles despu√©s de recibir tu pedido, siempre que la prenda est√© en perfecto estado."
  - q: "novedades"
    keywords: ["novedades", "nueva colecci√≥n", "nuevos productos", "lanzamientos", "lo nuevo", "√∫ltimas prendas"]
    a: "Cada semana lanzamos nuevas prendas urbanas üî•. ¬øQuieres que te avise cuando salga la pr√≥xima colecci√≥n?"
  - q: "contacto"
    keywords: ["contacto", "c√≥mo los contacto", "whatsapp", "instagram", "c√≥mo hablo con ustedes", "atenci√≥n al cliente"]
    a: "Puedes escribirnos directamente por WhatsApp o Instagram üì≤. Siempre respondemos r√°pido."
  - q: "qui√©nes son"
    keywords: ["qui√©nes son", "qui√©n eres", "sobre ustedes", "qui√©n est√° detr√°s", "acerca de", "historia", "qui√©n fund√≥", "qui√©n es urban elegance"]
    a: "Somos *Urban Elegance*, una marca de ropa urbana que combina estilo, actitud y elegancia. Dise√±amos prendas √∫nicas para quienes marcan tendencia."
  - q: "redes sociales"
    keywords: ["redes sociales", "instagram", "tiktok", "facebook", "s√≠guenos", "d√≥nde ver m√°s", "perfil social"]
    a: "S√≠guenos en Instagram y TikTok como *@UrbanElegance* para no perderte lo nuevo üí•."
  # =============================
  # Mensajes de cada flujo (tickets, escalaci√≥n, etc.)
  # =============================
  escalation:
    enabled: true
    message: "Voy a derivarte con un agente. Deja tu nombre y correo, por favor."
    thanks_message: "¬°Gracias! Un agente te contactar√° pronto."
  tickets:
    enabled: true
    message_ask_detail: "Por favor, describe brevemente el inconveniente o consulta que tienes. Cuanta m√°s informaci√≥n nos des, m√°s r√°pido podremos ayudarte."
    message_request_contact: "¬øNos puedes dejar tu correo electr√≥nico o n√∫mero de pedido para agilizar la gesti√≥n?"
    message_opened: "¬°Listo! Hemos registrado tu solicitud con el n√∫mero #{ticket_id}. Nuestro equipo te contactar√° pronto."
    message_status_template: "Ticket #{ticket_id} - Estado actual: {status}"

  # =============================
  # Rate limiting (antispam)
  # =============================
  rate_limit:
    per_user_per_minute: 30       # M√°ximo de mensajes por usuario por minuto
    message: "Demasiados mensajes, intenta en un minuto."
    global_per_minute: 200        # L√≠mite global opcional

  # =============================
  # Notificaciones a administradores (opcional)
  # =============================
  admin_notify:
    enabled: false
    channel_id: ""                # chat_id destino para avisos
    new_ticket_template: "Nuevo ticket #{ticket_id} de {user_id}: {text}"

  # =============================
  # Administraci√≥n (comandos)
  # =============================
  admin:
    enabled: true
    user_ids: []                # IDs permitidos para /admin (rellena con tus IDs)
    commands_help: |
      Comandos admin:
      - /admin reset_greeting <user_id>
      - /admin clear_history <user_id>
      - /admin set_topic <user_id> <topic>

# ===============================
# Overrides de ejemplo por chat_id (avanzado)
# ===============================
# Usa el ID del chat/grupo como clave de primer nivel. S√≥lo declara lo que cambias respecto al default.
# Ejemplo:
# "-100123456789":
#   enabled: true
#   features:
#     faq:
#       enabled: false
#   menus:
#     ...
